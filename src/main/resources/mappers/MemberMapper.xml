<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team4.joopging.mappers.MemberMapper">
    <!--아이디 중복 체크-->
    <select id="idCheck" resultType="_int">
        SELECT COUNT(*) FROM TBL_MEMBER WHERE MEMBERID=#{memberId}
    </select>
    <!--신규 회원 가입-->
    <insert id="join">
        INSERT INTO TBL_MEMBER
        (
            MEMBERNUM, MEMBERID, MEMBERPW, MEMBERPHONE, MEMBERNAME,
            MEMBERBIRTH, MEMBERGENDER, MEMBEREMAIL, MEMBERZIPCODE,
            MEMBERADDRESS, memberPloggingCnt, memberPoint,
            memberSavedPoint, memberAttend, memberLevel
        )
        VALUES
        (
            SEQ_MEMBER.NEXTVAL, #{memberId}, #{memberPw}, #{memberPhone}, #{memberName},
            #{memberBirth}, #{memberGender}, #{memberEmail}, #{memberZipcode},
            #{memberAddress}, 0 , 3000, 3000, 0, 1
        )
    </insert>
    <!--신규 카카오 회원 가입-->
    <insert id="joinKAKAO">
        INSERT INTO TBL_MEMBER_KAKAO
        (
            MEMBERNUM, MEMBERID, MEMBERNAME, MEMBERPHONE,
            MEMBERBIRTH, MEMBERGENDER, MEMBEREMAIL,
            MEMBERZIPCODE, MEMBERADDRESS, MEMBERPLOGGINGCNT, MEMBERPOINT,
            MEMBERSAVEDPOINT, MEMBERATTEND, MEMBERLEVEL, MEMBERSTATUS
        )
        VALUES
        (
            SEQ_MEMBER_KAKAO.NEXTVAL, #{memberId}, #{memberName}, '입력 없음',
            #{memberBirth}, #{memberGender}, #{memberEmail},
            '입력 없음', '입력 없음', 0, 3000,
            3000, 0, 1, 0
        )
    </insert>

    <!--신규 네이버 회원 가입-->
    <insert id="joinNAVER">
        INSERT INTO TBL_MEMBER_NAVER
        (
            MEMBERNUM, MEMBERID, MEMBERNAME, MEMBERPHONE,
            MEMBERBIRTH, MEMBERGENDER, MEMBEREMAIL,
            MEMBERZIPCODE, MEMBERADDRESS, MEMBERPLOGGINGCNT, MEMBERPOINT,
            MEMBERSAVEDPOINT, MEMBERATTEND, MEMBERLEVEL, MEMBERSTATUS
        )
        VALUES
        (
            SEQ_MEMBER_NAVER.NEXTVAL, #{memberId}, #{memberName}, '입력 없음',
            #{memberBirth}, #{memberGender}, #{memberEmail},
            '입력 없음', '입력 없음', 0, 3000,
            3000, 0, 1, 0
        )
    </insert>

    <!--로그인-->
    <select id="login" resultType="_int">
        SELECT COUNT(*) FROM TBL_MEMBER WHERE MEMBERID = #{memberId} AND MEMBERPW = #{memberPw}
    </select>
    <!--카카오로그인-->
    <select id="loginKAKAO" resultType="_int">
        SELECT COUNT(*) FROM TBL_MEMBER_KAKAO WHERE MEMBERID = #{memberId}
    </select>
    <!--네이버로그인-->
    <select id="loginNAVER" resultType="_int">
        SELECT COUNT(*) FROM TBL_MEMBER_NAVER WHERE MEMBERID = #{memberId}
    </select>

    <!--아이디 찾기-->
    <select id="searchId" resultType="String">
        SELECT MEMBERID FROM TBL_MEMBER WHERE
        MEMBERNAME = #{memberName} AND MEMBERBIRTH = #{memberBirth} AND
        MEMBERGENDER = #{memberGender} AND MEMBERPHONE = #{memberPhone}
    </select>

    <!--비밀번호 검색-->
    <select id="searchPw" resultType="string">
        SELECT MEMBERID FROM TBL_MEMBER
        WHERE MEMBERID = #{memberId} AND MEMBERNAME = #{memberName} AND MEMBERBIRTH = #{memberBirth} AND MEMBERGENDER=#{memberGender} AND MEMBERPHONE=#{memberPhone}
    </select>

    <!--비밀번호 변경-->
    <update id="updatePw">
        UPDATE TBL_MEMBER SET MEMBERPW=#{memberPw}
        WHERE MEMBERID = #{memberId}
    </update>

    <!--회원정보 전체 조회-->
    <select id="allSelect" resultType="MemberVO">
        SELECT
        MEMBERNUM, MEMBERID, MEMBERPW, MEMBERNAME, MEMBERPHONE,
        MEMBERBIRTH, MEMBERGENDER, MEMBEREMAIL, MEMBERREGIDATE,
        MEMBERZIPCODE, MEMBERADDRESS, MEMBERPLOGGINGCNT, MEMBERPOINT,
        MEMBERSAVEDPOINT, MEMBERATTEND, MEMBERATTENDSTATUS, MEMBERLEVEL, MEMBERSTATUS
        FROM TBL_MEMBER
        WHERE MEMBERID = #{memberId}
    </select>

    <!-- 출석체크 -->
    <update id="attendUpdate">
        UPDATE TBL_MEMBER
        SET MEMBERATTEND = MEMBERATTEND + 1, MEMBERATTENDSTATUS = 1
        WHERE MEMBERID = #{memberId}
    </update>

    <!-- 출석회수 조회 -->
    <select id="getAttendCnt" resultType="_int">
        SELECT MEMBERATTEND
        FROM TBL_MEMBER
        WHERE MEMBERID = #{memberId}
    </select>

    <!-- 매일 0시 마다 출석상태 초기화 -->
    <update id="resetAttendStatus">
        UPDATE TBL_MEMBER SET MEMBERATTENDSTATUS = 0 WHERE MEMBERID IS NOT NULL
    </update>

    <!-- 출석회수 10회일 경우 0으로 초기화 -->
    <update id="resetAttendCnt">
        UPDATE TBL_MEMBER SET MEMBERATTEND = 0 WHERE MEMBERATTEND = 10
    </update>

    <!-- 매월 1일 마다 멤버레벨 승급 -->
    <update id="updateLevelAmateur">
        UPDATE TBL_MEMBER
        SET MEMBERLEVEL = 2
        WHERE MEMBERSAVEDPOINT BETWEEN 10000 AND 29999
    </update>
    <update id="updateLevelVeteran">
        UPDATE TBL_MEMBER
        SET MEMBERLEVEL = 3
        WHERE MEMBERSAVEDPOINT BETWEEN 30000 AND 69999
    </update>
    <update id="updateLevelMaster">
        UPDATE TBL_MEMBER
        SET MEMBERLEVEL = 4
        WHERE MEMBERSAVEDPOINT >= 70000
    </update>

    <!-- 포인트 추가 -->
    <update id="pointUpdate">
        UPDATE TBL_MEMBER
        SET MEMBERPOINT = MEMBERPOINT + #{memberPoint}, MEMBERSAVEDPOINT = MEMBERSAVEDPOINT + #{memberPoint}
        WHERE MEMBERID = #{memberId}
    </update>

    <!--네이버 카카오 일반 회원의 이름 조회-->
    <select id="userName" resultType="MemberVO">
        SELECT MEMBERID, MEMBERNAME, MEMBERPLOGGINGCNT, MEMBERPOINT, MEMBERATTEND, MEMBERLEVEL
        FROM TBL_MEMBER
        WHERE MEMBERID = #{id}
    </select>
    <select id="userNameKAKAO" resultType="MemberVO">
        SELECT MEMBERID, MEMBERNAME, MEMBERPLOGGINGCNT, MEMBERPOINT, MEMBERATTEND, MEMBERLEVEL
        FROM TBL_MEMBER_KAKAO
        WHERE MEMBERID = #{id}
    </select>
    <select id="userNameNAVER" resultType="MemberVO">
        SELECT MEMBERID, MEMBERNAME, MEMBERPLOGGINGCNT, MEMBERPOINT, MEMBERATTEND, MEMBERLEVEL
        FROM TBL_MEMBER_NAVER
        WHERE MEMBERID = #{id}
    </select>

    <!--로그인 시 회원 탈퇴 여부 판단-->
    <select id="loginStatus" resultType="_int">
        SELECT MEMBERSTATUS
        FROM TBL_MEMBER
        WHERE MEMBERID = #{memberId}
    </select>

</mapper>