<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team4.joopging.mappers.MypageMapper">

    <!--예약번호로 찾기-->
    <select id="getPloRes" resultType="com.team4.joopging.mypage.vo.TempPloResVO">
        SELECT  ploResNum, memberId, ploResTitle, ploResLocation, ploggingNum, ploResDate,ploResTime,ploResStatus
        FROM TBL_PLO_RES WHERE ploResNum = #{ploResNum}
    </select>

    <!--플로깅 예약 목록-->
<select id="getPloResList" parameterType="map" resultType="com.team4.joopging.mypage.vo.TempPloResVO">

    <![CDATA[
    SELECT ploResNum, memberId, ploResTitle, ploResLocation, ploggingNum, ploResDate,ploResTime,ploResStatus
    FROM(
    SELECT /*+ INDEX_DESC(TBL_PLO_RES RESERVATION_PK)*/
    ROWNUM R, ploResNum, memberNum,ploResTitle, ploResLocation, ploggingNum, ploResDate,ploResTime,ploResStatus
    FROM TBL_PLO_RES WHERE memberId = #{memberId}
    AND
                ROWNUM <= #{criteria.pageNum} * #{criteria.amount}
            )
        WHERE R > (#{criteria.pageNum} - 1) * #{criteria.amount}
                        ]]>
</select>

    <!--내 플로깅 내역의 전체 개수-->
    <select id="totalPloResCnt" resultType="_int">
        SELECT COUNT(ploResNum) FROM TBL_PLO_RES WHERE memberId = #{memberId}
    </select>

    <!--내가 플로깅 개수-->
    <select id="realTotalPloResCnt" resultType="_int">
        SELECT COUNT(ploResNum) FROM TBL_PLO_RES WHERE memberId = #{memberId} AND NOT ploResStatus = 1
    </select>

<!--찜 목록의 상품정보-->
<select id="getGoodsLikeList" parameterType="map" resultType="com.team4.joopging.mypage.vo.TempGoodsLikeListVO">
        <![CDATA[
SELECT goodsLikeNum, goodsNum, GoodsName, GoodsPrice, memberId
FROM(
SELECT /*+ INDEX_DESC(TBL_GOODSLIST GoodsPK)*/
ROWNUM R, goodsLikeNum,goodsNum, GoodsName, GoodsPrice, memberId FROM TBL_GOODS_LIKE_LIST
WHERE memberId = #{memberId} AND
                ROWNUM <= #{criteria.pageNum} * #{criteria.amount}
            )
        WHERE R > (#{criteria.pageNum} - 1) * #{criteria.amount}
                        ]]>
</select>

    <!--내가 찜한 목록 전체 개수-->
    <select id="totalGoodsLikeCnt" resultType="_int">
        SELECT COUNT(goodsLikeListNum) FROM TBL_GOODS_LIKE_LIST WHERE memberId = #{memberId}
    </select>

    <!--찜 삭제-->
    <delete id="deleteGoodsLike">
        DELETE FROM TBL_GOODS_LIKE_LIST WHERE goodsLikeNum = #{goodsLikeNum}
    </delete>


<!--플로깅 예약 취소-->
<update id="deletePloRes">
UPDATE TBL_PLO_RES
SET ploResStatus = 1
WHERE ploResNum = #{ploResNum}
</update>

<!--아이디로 멤버 번호 찾기-->
<select id="selectMemberNum" resultType="_int">
    SELECT memberNum FROM TBL_MEMBER WHERE memberId = #{memberId}
</select>

<!--멤버 정보 수정-->
<update id="updateMember">
    UPDATE TBL_MEMBER
    SET memberEmail = #{memberEmail}, memberZipcode = #{memberZipcode}, memberAddress = #{memberAddress}
    WHERE memberId = #{memberId}
</update>

<!--멤버 삭제-->
<update id="deleteMember">
    UPDATE TBL_MEMBER
    SET memberStatus = 1
    WHERE memberId = #{memberId} AND memberPw = #{memberPw}
</update>

    <!--내 게시글 목록-->
    <select id="getMemberCommuList" parameterType="map" resultType="commuVO">
        <![CDATA[
        SELECT COMMUBNO, COMMUTITLE, COMMUCONTENT, COMMUWRITER, COMMUREGDATE, COMMUUPDATEDATE,COMMUVIEWCNT, COMMUBOARDSTATUS
        FROM
            (
                SELECT /*+ INDEX_DESC(TBL_COMMUBOARD PK_COMMUBOARD)*/
                ROWNUM R, COMMUBNO, COMMUTITLE, COMMUCONTENT, COMMUWRITER, COMMUREGDATE, COMMUUPDATEDATE, COMMUVIEWCNT, COMMUBOARDSTATUS
                FROM TBL_COMMUBOARD
                WHERE COMMUBOARDSTATUS = 0 AND
                ROWNUM <= #{criteria.pageNum} * #{criteria.amount}
                AND COMMUWRITER = #{memberId}
            )
        WHERE R > (#{criteria.pageNum} - 1) * #{criteria.amount}
                        ]]>
    </select>

    <!--내 게시글-->
    <select id="totalMemberCommuCnt" resultType="_int">
        SELECT COUNT(COMMUBNO) FROM TBL_COMMUBOARD WHERE COMMUWRITER = #{memberId}
    </select>

</mapper>