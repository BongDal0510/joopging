<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>플로깅 등록</title>
    <link rel="stylesheet" href="/css/main.css" type="text/css"/>
    <link rel="shortcut icon" href="/images/faviconWhite.ico">
    <link rel="icon" href="/images/faviconWhite.ico">
    <style>
        @font-face {
            font-family: 'S-CoreDream-3Light';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-3Light.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'S-CoreDream-4Regular';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-3Light.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'yg-jalnan';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_four@1.2/JalnanOTF00.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        /* Button */

        input[type="button"],
        input[type="submit"],
        input[type="reset"],
        button,
        .button {
            -webkit-appearance: none;
            display: inline-block;
            text-decoration: none;
            cursor: pointer;
            border: 0;
            border-radius: 5px;
            background: #14a876;
            color: #fff !important;
            font-weight: 700;
            outline: 0;
            font-size: 1.1em;
            padding: 0.65em 1.5em 0.65em 1.5em;
            text-align: center;
            -moz-transition: background-color .25s ease-in-out;
            -webkit-transition: background-color .25s ease-in-out;
            -ms-transition: background-color .25s ease-in-out;
            transition: background-color .25s ease-in-out;
        }

        input[type="button"]:hover,
        input[type="submit"]:hover,
        input[type="reset"]:hover,
        button:hover,
        .button:hover {
            background: #24b886;
        }

        input[type="button"]:active,
        input[type="submit"]:active,
        input[type="reset"]:active,
        button:active,
        .button:active {
            background: #049866;
        }

        input[type="button"].alt,
        input[type="submit"].alt,
        input[type="reset"].alt,
        button.alt,
        .button.alt {
            background: #0b871e;
        }

        input[type="button"].alt:hover,
        input[type="submit"].alt:hover,
        input[type="reset"].alt:hover,
        button.alt:hover,
        .button.alt:hover {
            background: #066514;
        }

        input[type="button"].alt:active,
        input[type="submit"].alt:active,
        input[type="reset"].alt:active,
        button.alt:active,
        .button.alt:active {
            background: #151112;
        }

        input[type="button"].icon:before,
        input[type="submit"].icon:before,
        input[type="reset"].icon:before,
        button.icon:before,
        .button.icon:before {
            opacity: 0.35;
            position: relative;
            top: 0.05em;
            margin-right: 0.75em;
        }

        input[type="button"].large,
        input[type="submit"].large,
        input[type="reset"].large,
        button.large,
        .button.large {
            font-size: 1.5em;
            padding: 0.75em 1.5em 0.75em 1.5em;
        }

        input[type="button"].large,
        input[type="submit"].large,
        input[type="reset"].large,
        button.large,
        .button.large {
            font-size: 1.1em;
            padding: 0.65em 1.5em 0.65em 1.5em;
        }


        .out {
            width: 400px;
            height: 550px;
            margin: 10px;
            padding: 10px;
            border: none;
        }

        .line {
            border: solid 1px #dddddd;
            border-radius: 5px;
        }

        p{
            color:#5d5d5d;
        }

        .headTitle {
            text-align:center;
            margin-bottom: 40px;
        }

        .writePopUp {
            font-family: 'S-CoreDream-4Regular';
        }

        #write span {
            width: 18%;
            line-height: 50px;
            font-size: 12pt;
            font-weight: 700;
        }

        #write input {
            height:50px;
            width: 82%;
        }

        .number {
            width: 30% !important;
            text-align: right;
        }

        .inputline {
            display: flex;
            margin-bottom: 20px;
        }

        .primary {
            width:100px;
            height:50px;
            background:#94c477;
        }

        #commuRegist {
            margin: 0 !important;
            width: auto !important;
            line-height: 1.5em;
            background: #94C477 !important;
        }

        #commuRegist:hover {
            background: #5d5d5d !important;
        }

        #content {
            width:100%;
            height:250px;
            resize: none;
        }

        .actions > li {
            margin: 0 !important;
            width: 20%;
        }

    </style>
</head>

<body>
<div class="writePopUp" style="margin: 30px 50px;">
    <!--제목-->
    <div>
        <h3 class="headTitle">플로깅 등록하기</h3>
    </div>

    <!--폼 태그-->
    <form action="/plo/ploWrite" name="ploForm" id="write" method="post">
        <div class="inputline">
            <span>플로깅명</span>
            <input class="line" type="text" id="ploggingTitle" name="ploggingTitle" placeholder="플로깅 행사이름" maxlength="8"/>
        </div>
        <div class="inputline">
            <span>신청일자</span>
            <input class="line" type="text" id="ploResDate" name="ploResDate" placeholder="신청가능한 일자"/>
        </div>
        <div class="inputline">
            <span>제한인원</span>
            <input class="line number" id="ploggingPplLimit" name="ploggingPplLimit" type="text" placeholder="30"/>
            <span style="width: 22%;">&nbsp 지급 포인트</span>
            <input class="line number" id="ploggingPoint" name="ploggingPoint" type="text" placeholder="100"/>
        </div>

        <span>내용</span>
        <pre><textarea id="content" name="ploggingContent" class="line" type="text">
▷ 장 소 :
▷ 기 간 :
▷ 참여방법
①

▷ 문의 : 줍깅 대표전화 1588-1004</textarea></pre>

        <!--첨부파일-->
        <div class="field">
            <span>첨부파일</span>
            <input type="file" name="uploadFiles" multiple>
            <div class="field">
                <div class="uploadResult">
                    <ul></ul>
                </div>
            </div>
            <div class="bigPictureWrapper">
                <div class="bigPicture"></div>
            </div>
        </div>

        <ul class="actions special" style="text-align: center; display: flex; justify-content: center;">
            <li><input type="submit" id="commuRegist" class="button" value="등록"/></li>
            <li><input type="submit" id="commuRegist" class="button" onclick="close()" value="취소"/></li>
        </ul>

        <!--버튼-->
<!--        <div style="text-align: center;">-->
<!--            <input type="button" class="clickButton" value="등록" onclick="goPloWrite()">-->
<!--            <span style="padding:1px"></span>-->
<!--            <input type="button" class="clickButton" value="취소" onclick="close()">-->
<!--        </div>-->

    </form>
</div>
</body>
<script src="/js/jquery.min.js"></script>
<script>
    function close(){
        window.close();
    }
</script>
<script>
    //파일이 있는지 없는지 확인
    let check = false;
    //이미지 보여주는 곳
    function showImage(fileCallPath){
        //만약 check이 false면 = 이미지 없음.
        if(check) {return;}
        //아닐경우 .bigPictureWrapper을 표시해준다.
        $(".bigPictureWrapper").css("display", "flex").show();
        //이미지 클릭시 원본 사이즈 이미지를 보여준다. 애니메이션 1초간.
        $(".bigPicture").html("<img src='/upload/plogging/display?fileName=" + encodeURIComponent(fileCallPath) + "'>")
            .animate({width:"100%", height:"100%"}, 1000);
        //이미지 있음 = check true
        check = true;
    }
    //이미지 사라지게 하는 곳
    $(".bigPictureWrapper").on("click", function(){
        //만약 이미지가 있다면?
        if(!check){return;}
        //이미지 클릭시 원본 이미지 없애기, 애니메이션 1초간
        $(".bigPicture").animate({width: "0%", height: "0%"}, 1000);
        setTimeout(function(){
            //이미지 상태 = 없음으로 바꿈
            check = false;
            //이미지 숨기기
            $(".bigPictureWrapper").hide();
        }, 1000)
    })
    /*확장자 제한*/
    $(document).ready(function(){
        let regex = new RegExp("(.*?)\.(exe|sh|zip|alz)$");
        //사이즈 제한
        let maxSize = 5242880;// 5MB
        let inputFile = $(".uploadDiv input");
        let uploadResult = $(".uploadResult ul");


        //등록 폼 submit시
        $("input[type='submit']").on("click", function(e){
            e.preventDefault();
            let form = $("form#registForm");
            let str = "";
            /*첨부 파일마다 반복*/
            $(".uploadResult ul li").each(function(i, obj){
                str += "<input type='hidden' id='attachList[" + i + "].fileName' name='attachList[" + i + "].fileName' value='" + $(obj).data('name') + "'>"
                str += "<input type='hidden' id='attachList[" + i + "].fileName' name='attachList[" + i + "].uuid' value='" + $(obj).data('uuid') + "'>"
                str += "<input type='hidden' id='attachList[" + i + "].fileName' name='attachList[" + i + "].uploadPath' value='" + $(obj).data('path') + "'>"
                str += "<input type='hidden' id='attachList[" + i + "].fileName' name='attachList[" + i + "].image' value='" + $(obj).data('type') + "'>"
            });
            form.append(str).submit();
        })
        /*파일 업로드*/
        function showUploadFile(uploadFiles){
            let str = "";
            $(uploadFiles).each(function(i, obj){
                //업로드한 파일이 이미지가 아닐경우
                if(!obj.image){
                    let fileCallPath = encodeURIComponent(obj.uploadPath + "/" + obj.fileName);

                    str += "<li data-path='" + obj.uploadPath + "' data-uuid='" + obj.uuid + "' data-name='" + obj.fileName.substring(obj.fileName.indexOf("_") + 1) + "' data-type='" + obj.image +"'>";
                    str += "<div>";
                    str += "<a href='/ploUpload/download?fileName=" + fileCallPath + "'>";
                    str += "<img src='/images/attach.png' width='100px'>" + obj.fileName.substring(obj.fileName.indexOf("_") + 1);
                    str += "</a>"
                    str += "<span data-file='" + fileCallPath + "' data-type='file'>x</span>";
                    str += "</div>";
                    str += "</li>";
                    //업로드한 파일이 이미지라면
                }else{
                    //썸네일 추가생성
                    let fileCallPath = encodeURIComponent(obj.uploadPath + "/s_" + obj.fileName);
                    let originPath = encodeURIComponent(obj.uploadPath + "/" + obj.fileName);

                    str += "<li data-path='" + obj.uploadPath + "' data-uuid='" + obj.uuid + "' data-name='" + obj.fileName.substring(obj.fileName.indexOf("_") + 1) + "' data-type='" + obj.image +"'>";
                    str += "<div>";
                    str += "<a href=\"javascript:showImage(\'" + originPath + "\')\">";
                    str += "<img src='/ploUpload/display?fileName=" + fileCallPath + "'>" + obj.fileName.substring(obj.fileName.indexOf("_") + 1);
                    str += "</a>";
                    str += "<span data-file='" + fileCallPath + "' data-type='image'>x</span>";
                    str += "</div>";
                    str += "</li>";
                }
            });
            uploadResult.append(str);
        }
        /*생성된 파일/이미지 html에 넣어줌*/
        $(".uploadResult").on("click", "span", function(){
            let targetFile = $(this).data("file");
            let type = $(this).data("type");
            let li = $(this).parents("li");

            //attachController 경로로 보내기
            $.ajax({
                url: "/ploUpload/deleteFile",
                type: "POST",
                data: {fileName:targetFile, type:type},
                dataType: "text",
                success: function(result){
                    alert(result);
                    li.remove();
                }
            });

        });

        //파일 등록시 예외처리
        function checkExtension(fileName, fileSize){
            //1. 확장자 별 업로드 제한
            if(regex.test(fileName)){
                alert("업로드 할 수 없는 파일의 형식입니다.");
                return false;
            }
            //2. 특정 크기 이상의 파일은 업로드 제한
            if(fileSize >= maxSize){
                alert("파일 사이즈 초과");
                return false;
            }
            return true;
        }
        /*upload 폴더 경로에 파일 업로드*/
        $("input[type='file']").change(function(){
            let formData = new FormData();
            let inputFile = $("input[name='uploadFiles']");
            let files = inputFile[0].files;

            for(let i=0; i<files.length; i++){
                if(!checkExtension(files[i].name, files[i].size)){ return; }
                formData.append("uploadFiles", files[i]);
            }

            $.ajax({
                url: "/ploUpload/uploadAjaxAction",
                type: "post",
                data: formData,
                contentType: false,
                processData: false,
                success: function(fileList){
                    showUploadFile(fileList);
                    inputFile.val("");
                }
            });
        });
    })
</script>
</html>